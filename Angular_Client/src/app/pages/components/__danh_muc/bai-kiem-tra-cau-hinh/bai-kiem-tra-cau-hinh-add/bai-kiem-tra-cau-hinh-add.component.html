<div class="card card-custom gutter-b" [class.d-none]="flagSuccess">
  <!-- Header Modal -->
  <div class="card-header">
    <div class="card-title">
      <h3 class="card-label">Thêm mới bài kiểm tra</h3>
    </div>
    <div class="card-toolbar">
      <button type="button" class="btn btn-light btn-elevate mr-2" routerLink="/danh-muc/danh-sach-bai-kiem-tra-cau-hinh">
        Trở lại
      </button>
      <div class="btn-group mr-3">
        <button type="submit" class="btn btn-primary" (click)="create()">Lưu</button>
        <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
          <button class="btn btn-primary btn-elevate" ngbDropdownToggle>
            <i class="ki ki-arrow-down icon-sm"></i>
          </button>
          <div class="dropdown-menu mt-3" ngbDropdownMenu>
            <button ngbDropdownItem (click)="saveTemp()">Lưu tạm</button>
            <button ngbDropdownItem>Lưu và thêm mới</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Header -->

  <!-- Body -->
  <div class="card-body">
    <form action="#" class="form form-label-right" [formGroup]="formThongTin">
      <div class="form-group row">
        <div class="col-lg-9">
          <label class="form-label">Tên bài kiểm tra</label>
          <input
            type="text"
            class="form-control form-control-lg"
            placeholder="Nhập tên bài kiểm tra"
            formControlName="tenBaiKiemTra"
            [class.is-invalid]="validateFormGroupEvent('tenBaiKiemTra', formThongTin, 1)"
            [class.is-valid]="validateFormGroupEvent('tenBaiKiemTra', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('tenBaiKiemTra', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('tenBaiKiemTra', formThongTin, 1)">
            Vui lòng nhập tên bài kiểm tra
          </div>
        </div>
        <div class="col-lg-3">
          <label class="form-label">Năm học</label>
          <input
            type="text"
            class="form-control form-control-lg"
            placeholder="Nhập giá trị mặc định"
            formControlName="namHoc"
            [class.is-invalid]="validateFormGroupEvent('namHoc', formThongTin, 1)"
            [class.is-valid]="validateFormGroupEvent('namHoc', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('namHoc', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('namHoc', formThongTin, 1)">
            Vui lòng nhập năm học
          </div>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-lg-3">
          <label class="form-label">Lớp</label>
          <mat-select class="form-control form-control-lg" placeholder="Chọn lớp" formControlName="lop">
            <mat-option value="10">Lớp 10</mat-option>
            <mat-option value="11">Lớp 11</mat-option>
            <mat-option value="12">Lớp 12</mat-option>
          </mat-select>
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('hocKy', formThongTin, 0)">Thông tin chính xác</div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('hocKy', formThongTin, 1)">
            Vui lòng chọn học kỳ
          </div>
        </div>
        <div class="col-lg-3">
          <label class="form-label">Số lượng đề</label>
          <input
            type="number"
            class="form-control form-control-lg text-right"
            placeholder="Nhập giá trị mặc định"
            formControlName="soLuongDe"
            [class.is-invalid]="validateFormGroupEvent('soLuongDe', formThongTin, 1)"
            [class.is-invalid]="validateFormGroupEvent('soLuongDe', formThongTin, 1, 'min')"
            [class.is-valid]="validateFormGroupEvent('soLuongDe', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('soLuongDe', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('soLuongDe', formThongTin, 1)">
            Vui lòng nhập số lượng đề
          </div>
        </div>
        <div class="col-lg-3">
          <label class="form-label">Thời gian làm bài (đơn vị: phút)</label>
          <input
            type="number"
            class="form-control form-control-lg text-right"
            placeholder="Nhập thời gian làm bài"
            formControlName="thoiGianLamBai"
            [class.is-invalid]="validateFormGroupEvent('thoiGianLamBai', formThongTin, 1)"
            [class.is-invalid]="validateFormGroupEvent('thoiGianLamBai', formThongTin, 1, 'min')"
            [class.is-valid]="validateFormGroupEvent('thoiGianLamBai', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('thoiGianLamBai', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('thoiGianLamBai', formThongTin, 1)">
            Vui lòng nhập nhập thời lượng làm bài kiểm tra
          </div>
        </div>
        <div class="col-lg-3">
          <label class="form-label">Học kỳ</label>
          <mat-select class="form-control form-control-lg" placeholder="Chọn học kỳ" formControlName="hocKy">
            <mat-option value="1">Học kỳ I</mat-option>
            <mat-option value="2">Học kỳ II</mat-option>
            <mat-option value="3">Cả hai</mat-option>
          </mat-select>
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('hocKy', formThongTin, 0)">Thông tin chính xác</div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('hocKy', formThongTin, 1)">
            Vui lòng chọn học kỳ
          </div>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-lg-3">
          <label class="form-label">Số lượng câu biết</label>
          <input
            type="number"
            class="form-control form-control-lg text-right"
            placeholder="Nhập số lượng câu hiểu"
            formControlName="cauBiet"
            [class.is-invalid]="validateFormGroupEvent('cauBiet', formThongTin, 1)"
            [class.is-invalid]="validateFormGroupEvent('cauBiet', formThongTin, 1, 'min')"
            [class.is-valid]="validateFormGroupEvent('cauBiet', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('cauBiet', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('cauBiet', formThongTin, 1)">
            Vui lòng nhập số lượng câu dễ
          </div>
        </div>
        <div class="col-lg-3">
          <label class="form-label">Số lượng câu hiểu</label>
          <input
            type="number"
            class="form-control form-control-lg text-right"
            placeholder="Nhập số lượng câu dễ"
            formControlName="cauHieu"
            [class.is-invalid]="validateFormGroupEvent('cauHieu', formThongTin, 1)"
            [class.is-invalid]="validateFormGroupEvent('cauHieu', formThongTin, 1, 'min')"
            [class.is-valid]="validateFormGroupEvent('cauHieu', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('cauHieu', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('cauHieu', formThongTin, 1)">
            Vui lòng nhập số lượng câu trung bình
          </div>
        </div>
        <div class="col-lg-3">
          <label class="form-label">Số lượng câu vận dụng thấp</label>
          <input
            type="number"
            class="form-control form-control-lg text-right"
            placeholder="Nhập số lượng câu vận dụng thấp"
            formControlName="cauVanDungThap"
            [class.is-invalid]="validateFormGroupEvent('cauVanDungThap', formThongTin, 1)"
            [class.is-invalid]="validateFormGroupEvent('cauVanDungThap', formThongTin, 1, 'min')"
            [class.is-valid]="validateFormGroupEvent('cauVanDungThap', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('cauVanDungThap', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('cauVanDungThap', formThongTin, 1)">
            Vui lòng nhập số lượng câu vận dụng thấp
          </div>
        </div>
        <div class="col-lg-3">
          <label class="form-label">Số lượng câu vận dụng cao</label>
          <input
            type="number"
            class="form-control form-control-lg text-right"
            placeholder="Nhập số lượng câu vận dụng cao"
            formControlName="cauVanDungCao"
            [class.is-invalid]="validateFormGroupEvent('cauVanDungCao', formThongTin, 1)"
            [class.is-invalid]="validateFormGroupEvent('cauVanDungCao', formThongTin, 1, 'min')"
            [class.is-valid]="validateFormGroupEvent('cauVanDungCao', formThongTin, 0)"
          />
          <div class="valid-feedback" *ngIf="validateFormGroupEvent('cauVanDungCao', formThongTin, 0)">
            Thông tin chính xác
          </div>
          <div class="invalid-feedback" *ngIf="validateFormGroupEvent('cauVanDungCao', formThongTin, 1)">
            Vui lòng nhập số lượng câu vận dụng cao
          </div>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-lg-12 text-right">
          <p>
            Tổng câu hỏi: <strong class="text-danger">{{ getSum() }}</strong>
          </p>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-lg-12">
          <button type="button" class="btn btn-success m-auto" (click)="createQuestion()">
            <!-- [disabled]="formThongTin.invalid" -->
            Tạo câu hỏi
          </button>
        </div>
      </div>
      <hr/>
      <ng-container *ngIf="this.loadingQuestion$ | async">
        <div class="overlay-layer bg-transparent">
          <div class="spinner spinner-lg spinner-success"></div>
        </div>
      </ng-container>
    </form>
    <form [formGroup]="formThongTin">
      <ng-container formArrayName="cauHoi">
        <ng-container *ngFor="let item of cauHoi.controls; index as i">
          <ng-container [formGroupName]="i">
            <div class="form-group row">
              <div class="col-lg-4 text-left">
                <h4><strong>Câu {{ i + 1 }}</strong></h4>
              </div>     
              <div class="col-lg-4 text-center">
                <span
                    class="label label-lg label-inline"
                    matTooltip="Nhấn để thay đổi cấp độ"
                    matTooltipPosition="after"
                    style="cursor: pointer;"
                    (click)="changeLevel(i)"
                    [class.label-success]="this.cauHoi.value[i].level === 1"
                    [class.label-primary]="this.cauHoi.value[i].level === 2"
                    [class.label-warning]="this.cauHoi.value[i].level === 3"
                    [class.label-info]="this.cauHoi.value[i].level === 4"
                  >
                    <ng-container *ngIf="this.cauHoi.value[i].level === 1">Câu biết</ng-container>
                    <ng-container *ngIf="this.cauHoi.value[i].level === 2">Câu hiểu</ng-container>
                    <ng-container *ngIf="this.cauHoi.value[i].level === 3">Câu vận dụng thấp</ng-container>
                    <ng-container *ngIf="this.cauHoi.value[i].level === 4">Câu vận dụng cao</ng-container>
                  </span>
              </div>   
              <div class="col-lg-4 text-right">
                <mat-icon style="color: red; cursor: pointer;" matTooltip="Xóa câu hỏi này" (click)="removeQuestion(i)">remove_circle_outline</mat-icon>
              </div>      
            </div>
            <div class="form-group row">
              <div class="col-lg-12">
              <ckeditor [editor]="Editor" formControlName="content"></ckeditor>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-lg-12">
                <ng-container class="mx-5">
                  <label class="mr-10">Đáp án đúng:</label>
                  <mat-radio-group formControlName="correct">
                    <mat-radio-button class="mr-10" value="1">A</mat-radio-button>
                    <mat-radio-button class="mr-10" value="2">B</mat-radio-button>
                    <mat-radio-button class="mr-10" value="3">C</mat-radio-button>
                    <mat-radio-button class="mr-10" value="4">D</mat-radio-button>
                  </mat-radio-group>
                </ng-container>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-lg-12">
                <hr class="my-4">
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
    </form>
    <div class="form-group row" *ngIf="activeQuestion">
      <div class="col-lg-12">
        <div ngbDropdown class="d-inline-block float-right">        
          <button class="btn btn-success" id="dropdownBasic1" ngbDropdownToggle>Thêm câu hỏi &nbsp;<i class="ki ki-arrow-down icon-sm"></i></button>
          <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
            <ng-container *ngFor="let item of listSelectAddQuestion">
              <button class="dropdown-item" (click)="createNewQuestion(item.Level)">{{item.Name}}</button>
            </ng-container>
          </div>
        </div>
      </div>      
    </div>
  </div>
  <!-- End Body -->
</div>
<app-success [class.d-none]="!flagSuccess" [back]="backUrl" [create]="createUrl"></app-success>